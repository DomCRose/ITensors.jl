<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MPS and MPO Examples · ITensors.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.png" alt="ITensors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">ITensors.jl</span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Introduction</a></li><li><span class="tocitem">Code Examples</span><ul><li><a class="tocitem" href="ITensor.html">ITensor Examples</a></li><li class="is-active"><a class="tocitem" href="MPSandMPO.html">MPS and MPO Examples</a><ul class="internal"><li><a class="tocitem" href="#Applying-a-Single-site-Operator-to-an-MPS-1"><span>Applying a Single-site Operator to an MPS</span></a></li><li><a class="tocitem" href="#Applying-a-Two-site-Operator-to-an-MPS-1"><span>Applying a Two-site Operator to an MPS</span></a></li><li><a class="tocitem" href="#Computing-the-Entanglement-Entropy-of-an-MPS-1"><span>Computing the Entanglement Entropy of an MPS</span></a></li><li><a class="tocitem" href="#Write-and-Read-an-MPS-or-MPO-to-Disk-with-HDF5-1"><span>Write and Read an MPS or MPO to Disk with HDF5</span></a></li></ul></li><li><a class="tocitem" href="DMRG.html">DMRG Examples</a></li><li><a class="tocitem" href="Physics.html">Physics System Examples</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../IndexType.html">Index</a></li><li><a class="tocitem" href="../IndexValType.html">IndexVal</a></li><li><a class="tocitem" href="../IndexSetType.html">IndexSet</a></li><li><a class="tocitem" href="../ITensorType.html">ITensor</a></li><li><a class="tocitem" href="../MPSandMPO.html">MPS and MPO</a></li><li><a class="tocitem" href="../QN.html">QN</a></li><li><a class="tocitem" href="../SiteType.html">SiteType and op</a></li><li><input class="collapse-toggle" id="menuitem-3-8" type="checkbox"/><label class="tocitem" for="menuitem-3-8"><span class="docs-label">DMRG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../DMRG.html">DMRG</a></li><li><a class="tocitem" href="../Sweeps.html">Sweeps</a></li><li><a class="tocitem" href="../ProjMPO.html">ProjMPO</a></li><li><a class="tocitem" href="../ProjMPOSum.html">ProjMPOSum</a></li><li><a class="tocitem" href="../Observer.html">Observer System for DMRG</a></li><li><a class="tocitem" href="../DMRGObserver.html">DMRGObserver</a></li></ul></li><li><a class="tocitem" href="../AutoMPO.html">AutoMPO</a></li></ul></li><li><span class="tocitem">Advanced usage guide</span><ul><li><a class="tocitem" href="../AdvancedUsageGuide.html">Advanced usage guide</a></li><li><a class="tocitem" href="../Multithreading.html">Multithreading</a></li><li><a class="tocitem" href="../QNTricks.html">Symmetric tensor background and usage</a></li><li><a class="tocitem" href="../CodeTiming.html">Timing and profiling</a></li><li><a class="tocitem" href="../ContractionSequenceOptimization.html">Contraction sequence optimization</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Code Examples</a></li><li class="is-active"><a href="MPSandMPO.html">MPS and MPO Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="MPSandMPO.html">MPS and MPO Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ITensor/ITensors.jl/blob/master/docs/src/examples/MPSandMPO.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="MPS-and-MPO-Examples-1"><a class="docs-heading-anchor" href="#MPS-and-MPO-Examples-1">MPS and MPO Examples</a><a class="docs-heading-anchor-permalink" href="#MPS-and-MPO-Examples-1" title="Permalink"></a></h1><h2 id="Applying-a-Single-site-Operator-to-an-MPS-1"><a class="docs-heading-anchor" href="#Applying-a-Single-site-Operator-to-an-MPS-1">Applying a Single-site Operator to an MPS</a><a class="docs-heading-anchor-permalink" href="#Applying-a-Single-site-Operator-to-an-MPS-1" title="Permalink"></a></h2><p>In many applications one needs to modify a matrix product  state (MPS) by multiplying it with an operator that acts  only on a single site. This is actually a very straightforward operation and this formula shows you how to do it in ITensor.</p><p>Say we have an operator <span>$G^{s&#39;_3}_{s_3}$</span> which which acts non-trivially on site 3 of our MPS <code>psi</code> as in the following diagram:</p><p><img src="mps_onesite_figures/operator_app_mps.png" alt/></p><p>To carry out this operation, contract the operator G with the MPS tensor for site 3, removing the prime from the <span>$s&#39;_3$</span> index afterward:</p><p><img src="mps_onesite_figures/operator_contract.png" alt/></p><pre><code class="language-julia">newA = G * psi[3]
noprime!(newA)</code></pre><p>Finally, put the new tensor back into MPS <code>psi</code> to update its third MPS tensor:</p><pre><code class="language-julia">psi[3] = newA</code></pre><p>Afterward, we can visualize the modified MPS as:</p><p><img src="mps_onesite_figures/updated_mps.png" alt/></p><p>As a technical note, if you are working in a context where gauge or orthogonality properties of the MPS are important, such as in time evolution using two-site gates,  then you may want to call <code>orthogonalize!(psi,3)</code> before modifying the tensor at site 3, which will ensure that the MPS remains in a  well-defined orthogonal gauge centered on site 3. Modifying a tensor which is left- or right-orthogonal (i.e. not the &quot;center&quot; tensor of the gauge) will destroy the gauge condition and  require extra operations to restore it. (Calling <code>orthogonalize!</code> method will automatically fix this but will have to do extra work to do so.)</p><h2 id="Applying-a-Two-site-Operator-to-an-MPS-1"><a class="docs-heading-anchor" href="#Applying-a-Two-site-Operator-to-an-MPS-1">Applying a Two-site Operator to an MPS</a><a class="docs-heading-anchor-permalink" href="#Applying-a-Two-site-Operator-to-an-MPS-1" title="Permalink"></a></h2><p>A very common operation with matrix product states (MPS) is  multiplication by a two-site operator or &quot;gate&quot; which modifies  the MPS. This procedure can be carried out in an efficient,  controlled way which is adaptive in the MPS bond dimension.</p><p>Say we have an operator <span>$G^{s&#39;_3 s&#39;_4}_{s_3 s_4}$</span> which is our gate and which acts on physical sites 3 and 4 of our MPS <code>psi</code>, as in the following diagram:</p><p><img src="twosite_figures/gate_app_mps.png" alt/></p><p>To apply this gate in a controlled manner, first &#39;gauge&#39; the MPS <code>psi</code> such that either site 3 or 4 is the <em>orthogonality center</em>. Here we make site 3 the center:</p><pre><code class="language-julia">orthogonalize!(psi,3)</code></pre><p><img src="twosite_figures/gate_gauge.png" alt/></p><p>The other MPS tensors are now either left-orthogonal or right-orthogonal and can be left out of further steps without producing incorrect results.</p><p>Next, contract the gate tensor G with the MPS tensors for sites 3 and 4</p><p><img src="twosite_figures/gate_contract.png" alt/></p><pre><code class="language-julia">wf = (psi[3] * psi[4]) * G
noprime!(wf)</code></pre><p>Finally, use the singular value decomposition (SVD) to factorize the resulting tensor, multiplying the singular values into either U or V. Assign these two tensors back into the MPS to update it.</p><p><img src="twosite_figures/gate_svd.png" alt/></p><pre><code class="language-julia">inds3 = uniqueinds(psi[3],psi[4])
U,S,V = svd(wf,inds3,cutoff=1E-8)
psi[3] = U
psi[4] = S*V</code></pre><p>The call to <code>uniqueinds(psi[3])</code> analyzes the indices of <code>psi[3]</code> and <code>psi[4]</code>  and finds any which are unique to just <code>psi[3]</code>, saving this collection of indices as <code>inds3</code>. Passing this collection of indices to the <code>svd</code> function tells it to treat any indices  that are unique to <code>psi[3]</code> as the indices which should go onto the <code>U</code> tensor afterward. We also set a truncation error cutoff of 1E-8 in the call to <code>svd</code> to truncate  the smallest singular values and control the size of the resulting MPS. Other cutoff values can be used, depending on the desired accuracy, as well as limits on the maximum bond dimension (<code>maxdim</code> keyword argument).</p><p><strong>Complete code example</strong></p><pre><code class="language-julia">orthogonalize!(psi,3)

wf = (psi[3] * psi[4]) * G
noprime!(wf)

inds3 = uniqueinds(psi[3],psi[4])
U,S,V = svd(wf,inds3,cutoff=1E-8)
psi[3] = U
psi[4] = S*V</code></pre><h2 id="Computing-the-Entanglement-Entropy-of-an-MPS-1"><a class="docs-heading-anchor" href="#Computing-the-Entanglement-Entropy-of-an-MPS-1">Computing the Entanglement Entropy of an MPS</a><a class="docs-heading-anchor-permalink" href="#Computing-the-Entanglement-Entropy-of-an-MPS-1" title="Permalink"></a></h2><p>A key advantage of using the matrix product state (MPS) format to represent quantum wavefunctions is that it allows one to efficiently compute the entanglement entropy of any left-right bipartition of the system in one dimension, or for a two-dimensional system any &quot;cut&quot; along the MPS path.</p><p>Say that we have obtained an MPS <code>psi</code> of length N and we wish to compute the entanglement entropy of a bipartition of the system into a region &quot;A&quot; which consists of sites 1,2,...,b and a region B consisting of sites b+1,b+2,...,N.</p><p>Then the following code formula can be used to accomplish this task:</p><pre><code class="language-julia">orthogonalize!(psi, b)
U,S,V = svd(psi[b], (linkind(psi, b-1), siteind(psi,b)))
SvN = 0.0
for n=1:dim(S, 1)
  p = S[n,n]^2
  SvN -= p * log(p)
end</code></pre><p>As a brief explanation of the code above, the call to <code>orthogonalize!(psi,b)</code> shifts the orthogonality center to site <code>b</code> of the MPS. </p><p>The call to the <code>svd</code> routine says to treat the link (virtual or bond) Index connecting the b&#39;th MPS tensor <code>psi[b]</code> and the b&#39;th physical Index as &quot;row&quot; indices for the purposes of the SVD (these indices will end up on <code>U</code>, along with the Index connecting <code>U</code> to <code>S</code>).</p><p>The code in the <code>for</code> loop iterates over the diagonal elements of the <code>S</code> tensor (which are the singular values from the SVD), computes their squares to obtain the probabilities of observing the various states in the Schmidt basis (i.e. eigenvectors of the left-right bipartition reduced density matrices), and puts them into the von Neumann entanglement entropy formula <span>$S_\text{vN} = - \sum_{n} p_{n} \log{p_{n}}$</span>.</p><h2 id="Write-and-Read-an-MPS-or-MPO-to-Disk-with-HDF5-1"><a class="docs-heading-anchor" href="#Write-and-Read-an-MPS-or-MPO-to-Disk-with-HDF5-1">Write and Read an MPS or MPO to Disk with HDF5</a><a class="docs-heading-anchor-permalink" href="#Write-and-Read-an-MPS-or-MPO-to-Disk-with-HDF5-1" title="Permalink"></a></h2><p><strong>Writing an MPS to an HDF5 File</strong></p><p>Let&#39;s say you have an MPS <code>psi</code> which you have made or obtained from a calculation. To write it to an HDF5 file named &quot;myfile.h5&quot; you can use the following pattern:</p><pre><code class="language-julia">using HDF5
f = h5open(&quot;myfile.h5&quot;,&quot;w&quot;)
write(f,&quot;psi&quot;,psi)
close(f)</code></pre><p>Above, the string &quot;psi&quot; can actually be any string you want such as &quot;MPS psi&quot; or &quot;Result MPS&quot; and doesn&#39;t have to have the same name as the reference <code>psi</code>. Closing the file <code>f</code> is optional and you can also write other objects to the same file before closing it.</p><p><strong>Reading an MPS from an HDF5 File</strong></p><p>Say you have an HDF5 file &quot;myfile.h5&quot; which contains an MPS stored as a dataset with the name &quot;psi&quot;. (Which would be the situation if you wrote it as in the example above.) To read this ITensor back from the HDF5 file, use the following pattern:</p><pre><code class="language-julia">using HDF5
f = h5open(&quot;myfile.h5&quot;,&quot;r&quot;)
psi = read(f,&quot;psi&quot;,MPS)
close(f)</code></pre><p>Many functions which involve MPS, such as the <code>dmrg</code> function or the <code>AutoMPO</code> system require that you use an array of site indices which match the MPS. So when reading in an MPS from disk, do not construct a new array of site indices. Instead, you can obtain them like this: <code>sites = siteinds(psi)</code>.</p><p>So for example, to create an MPO from an AutoMPO which has the same site indices as your MPS <code>psi</code>, do the following:</p><pre><code class="language-julia">ampo = AutoMPO()
# Then put operators into ampo...

sites = siteinds(psi) # Get site indices from your MPS
H = MPO(ampo,sites)

# Compute &lt;psi|H|psi&gt;
energy_psi = inner(psi,H,psi)</code></pre><p>Note the <code>MPS</code> argument to the read function, which tells Julia which read function to call and how to interpret the data stored in the HDF5 dataset named &quot;psi&quot;. In the  future we might lift the requirement of providing the type and have it be detected automatically from the data stored in the file.</p><p><strong>Writing and Reading MPOs</strong></p><p>To write or read MPOs to or from HDF5 files, just follow the examples above but use the type <code>MPO</code> when reading an MPO from the file instead of the type <code>MPS</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="ITensor.html">« ITensor Examples</a><a class="docs-footer-nextpage" href="DMRG.html">DMRG Examples »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 28 April 2021 15:52">Wednesday 28 April 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
